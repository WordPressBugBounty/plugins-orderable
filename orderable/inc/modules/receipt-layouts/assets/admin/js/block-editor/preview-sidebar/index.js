(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,r=window.wp.plugins,n=window.wp.editor,a=window.wp.components,o=window.wp.element,i=window.wp.i18n,l=window.wp.data,s=window.wp.apiFetch;var c=e.n(s);const d=window.wp.url,p=window.wp.compose;function u(e){const t={per_page:4,status:["pending","processing","on-hold","completed"],...e};return c()({path:(0,d.addQueryArgs)("wc/v3/orders",t)})}const w=e=>(0,t.createElement)(a.ComboboxControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,i.__)("Order","orderable"),help:(0,i.__)("Select the order from the list or type to search","orderable"),...e}),m=({canPreview:e,layoutId:r})=>{const[n,l]=(0,o.useState)(),[s,c]=(0,o.useState)(!0),[d,m]=(0,o.useState)(),[_,b]=(0,o.useState)([]),[g,h]=(0,o.useState)(),y=!e||d;(0,o.useEffect)((()=>{c(!0),u({search:g||void 0}).then((e=>{b(e.map((e=>({value:e.id,label:`#${e.id} - ${e.billing.first_name} ${e.billing.last_name}`})))),n||l(e[0].id)})).finally((()=>{c(!1)}))}),[g,n]);const f=(0,p.debounce)((e=>{e&&(c(!0),h(e))}),300),v=(0,t.createElement)(w,{value:n,onChange:e=>{e?l(e):h("")},isLoading:s,options:_,onFilterValueChange:f});return(0,t.createElement)(t.Fragment,null,y&&(0,t.createElement)(a.Disabled,{style:{opacity:"0.75"}},v),!y&&v,(0,t.createElement)(a.Button,{variant:"primary",icon:d?(0,t.createElement)(a.Spinner,{style:{margin:"0 0 0 9px"}}):"external",iconPosition:"right",disabled:s||!e,style:{marginTop:"15px"},onClick:()=>{var e,t;m(!0),(e=n,t=r,wp.apiFetch({path:`wc/v3/orders/${e}/receipt?force_new=true&orderable_layout_id=${t}`,method:"POST"}).then((e=>{const t=e?.receipt_url;if(wp.url.isURL(t))return t}))).then((e=>{e&&window.open(e,"_blank")})).finally((()=>{m(!1)}))}},(0,i.__)("Preview","orderable")))};(0,r.registerPlugin)("orderable-receipt-layout-preview-sidebar",{render:()=>{const[e,r]=(0,o.useState)(!0),[s,c]=(0,o.useState)(!1),d=(0,l.useSelect)((e=>e(n.store.name).getCurrentPost()),[]),p="auto-draft"!==d.status;(0,o.useEffect)((()=>{r(!0),u({per_page:1}).then((e=>{c(!!e?.length)})).finally((()=>{r(!1)}))}),[]);const w=p&&s;let _;switch(!1){case p:_=(0,i.__)("You need to publish the receipt layout first to preview it.","orderable");break;case s:_=(0,i.__)("You need to have at least one order to preview the receipt.","orderable");break;default:_=""}return(0,t.createElement)(n.PluginSidebar,{name:"plugin-sidebar-example",title:(0,i.__)("Preview","orderable"),icon:"printer"},(0,t.createElement)(a.PanelBody,null,!w&&(0,t.createElement)(a.__experimentalSpacer,{marginBottom:"16px"},(0,t.createElement)(a.Notice,{status:"warning",isDismissible:!1,style:{marginBottom:"20px"}},_)),(0,t.createElement)("p",null,(0,i.__)("Preview the receipt layout using real data.","orderable")),e&&(0,t.createElement)(a.Flex,{justify:"center"},(0,t.createElement)(a.Spinner,null)),!e&&(0,t.createElement)(m,{canPreview:w,layoutId:d.id})))}})})();